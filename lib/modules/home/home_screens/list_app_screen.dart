/// Author: Duc Trung Nguyen
/// Created: 18/05/2021
/// Project: ohmalware

import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:grouped_list/grouped_list.dart';
import 'package:ohmalware/commons/enum.dart';
import 'package:ohmalware/models/models.dart';
import 'package:ohmalware/modules/details/controllers/detail_controller.dart';
import 'package:ohmalware/modules/details/details_screens/screens.dart';
import 'package:ohmalware/modules/home/controllers/home_controller.dart';
import 'package:device_apps/device_apps.dart';

class ListAppScreen extends StatefulWidget {
  const ListAppScreen({this.typeApp, this.title, Key key}) : super(key: key);

  final TYPE_APP typeApp;
  final String title;

  @override
  _ListAppScreenState createState() => _ListAppScreenState();
}

class _ListAppScreenState extends State<ListAppScreen> {
  final HomeController _homeController = Get.find();

  @override
  Widget build(BuildContext context) {
    final listApp = widget.typeApp == TYPE_APP.normal
        ? _homeController.listResultAppScanModelNormalApp
        : _homeController.listResultAppScanModelMalware;

    return Scaffold(
        appBar: AppBar(
          title: Text(widget.title),
          backgroundColor: Colors.lightBlueAccent,
        ),
        body: ListView.builder(
            itemCount: listApp.length,
            itemBuilder: (_, index) {
              final element = listApp[index];

              final detailsApp = _homeController.listApp.firstWhere(
                  (elementApplicationWithIcon) =>
                      elementApplicationWithIcon.packageName ==
                      element.package);
              return Card(
                elevation: 8.0,
                margin: EdgeInsets.symmetric(horizontal: 5, vertical: 3),
                child: Container(
                  child: GestureDetector(
                    onTap: () async {
                      Get.to(DetailsScreen(
                        app: detailsApp,
                      ));
                    },
                    child: ListTile(
                      leading: detailsApp is ApplicationWithIcon
                          ? CircleAvatar(
                              backgroundImage: MemoryImage(
                                  (detailsApp as ApplicationWithIcon).icon),
                              backgroundColor: Colors.white,
                            )
                          : null,
                      title: Text(
                        (element as ResultAppScanModel).name,
                        style: TextStyle(fontWeight: FontWeight.w800),
                      ),
                      trailing: Icon(
                        !(element as ResultAppScanModel).isMalware
                            ? Icons.check_circle_outline
                            : Icons.cancel_outlined,
                        color: !(element as ResultAppScanModel).isMalware
                            ? Colors.blueAccent
                            : Colors.redAccent,
                        size: 20.0,
                      ),
                    ),
                  ),
                ),
              );
              return Container();
            }));


  }
}
